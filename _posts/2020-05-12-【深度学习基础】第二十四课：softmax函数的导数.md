---
layout:     post
title:      ã€æ·±åº¦å­¦ä¹ åŸºç¡€ã€‘ç¬¬äºŒåå››è¯¾ï¼šsoftmaxå‡½æ•°çš„å¯¼æ•°
subtitle:   softmaxå‡½æ•°åœ¨ç¥ç»ç½‘ç»œä¸­çš„åå‘ä¼ æ’­
date:       2020-05-12
author:     x-jeff
header-img: blogimg/20200512.jpg
catalog: true
tags:
    - Deep Learning Series
---
>ã€æ·±åº¦å­¦ä¹ åŸºç¡€ã€‘ç³»åˆ—åšå®¢ä¸ºå­¦ä¹ Courseraä¸Šå´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨‹æ‰€åšçš„è¯¾ç¨‹ç¬”è®°ã€‚  
>æœ¬æ–‡ä¸ºåŸåˆ›æ–‡ç« ï¼Œæœªç»æœ¬äººå…è®¸ï¼Œç¦æ­¢è½¬è½½ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚

# 1.softmaxå‡½æ•°

ğŸ‘‰[softmaxå‡½æ•°è¯¦è§£](http://shichaoxin.com/2019/09/04/æ·±åº¦å­¦ä¹ åŸºç¡€-ç¬¬äºŒè¯¾-softmaxåˆ†ç±»å™¨å’Œäº¤å‰ç†µæŸå¤±å‡½æ•°/)ã€‚

# 2.softmaxå‡½æ•°çš„å¯¼æ•°

å‡è®¾ç¥ç»ç½‘ç»œè¾“å‡ºå±‚çš„æ¿€æ´»å‡½æ•°ä¸ºsoftmaxå‡½æ•°ï¼Œç”¨ä»¥è§£å†³å¤šåˆ†ç±»é—®é¢˜ã€‚åœ¨åå‘ä¼ æ’­æ—¶ï¼Œå°±éœ€è¦è®¡ç®—softmaxå‡½æ•°çš„å¯¼æ•°ï¼Œè¿™ä¹Ÿå°±æ˜¯æœ¬æ–‡ç€é‡ä»‹ç»çš„å†…å®¹ã€‚

æˆ‘ä»¬åªéœ€å…³æ³¨è¾“å‡ºå±‚å³å¯ï¼Œå…¶ä½™å±‚å’Œä¹‹å‰ä»‹ç»çš„äºŒåˆ†ç±»æ¨¡å‹ä¸€æ ·ï¼Œä¸å†èµ˜è¿°ã€‚

æˆ‘ä»¬å…ˆè€ƒè™‘åªæœ‰ä¸€ä¸ªæ ·æœ¬çš„æƒ…å†µï¼Œè¾“å‡ºå±‚çš„$z^{[L]},a^{[L]}$ä»¥åŠæ ‡ç­¾yä¸ºï¼ˆå‡è®¾é¢„æµ‹ç±»åˆ«å…±æœ‰Kç±»ï¼‰ï¼š

$$z^{[L]}= \begin{bmatrix} z_1 \\ z_2 \\ \vdots \\ z_K \\ \end{bmatrix} ; a^{[L]} = \begin{bmatrix} a_1 \\ a_2 \\ \vdots \\ a_K \\ \end{bmatrix};y=\begin{bmatrix} y_1 \\ y_2 \\ \vdots \\ y_K \\ \end{bmatrix}$$

å…¶ä¸­ï¼š

$$a_j=\frac{e^{z_j}}{\sum^K_{k=1}e^{z_k}},j\in [1,2,...,K] \tag{1}$$

ä½¿ç”¨[äº¤å‰ç†µæŸå¤±å‡½æ•°](http://shichaoxin.com/2019/09/04/æ·±åº¦å­¦ä¹ åŸºç¡€-ç¬¬äºŒè¯¾-softmaxåˆ†ç±»å™¨å’Œäº¤å‰ç†µæŸå¤±å‡½æ•°/)æ„å»ºcost functionï¼š

$$C=-\sum^K_{k=1} y_k \ln a_k \tag{2}$$

å…¶ä¸­ï¼Œ$y_k$ç­‰äº0æˆ–1ã€‚

å¾ˆå®¹æ˜“ç®—å‡ºï¼š

$$\frac{\partial C}{\partial a_j}=-\frac{y_j}{a_j} \tag{3}$$

æ¥ä¸‹æ¥æˆ‘ä»¬åªè¦ç®—å‡º$\frac{\partial a_j}{ \partial z_i}$å³å¯ã€‚è¿™é‡Œä¹‹æ‰€ä»¥æ˜¯$z_i$è€Œä¸æ˜¯$z_j$æ˜¯å› ä¸ºä½¿ç”¨softmaxè®¡ç®—å¾—åˆ°çš„$a_j$åŒ…å«äº†$z^{[L]}$ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯è¯´$a_j$å¯å¯¹$z^{[L]}$ä¸­çš„ä»»æ„å…ƒç´ æ±‚å¯¼ï¼Œè€Œä¸ä»…ä»…åªæ˜¯$z_j$ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åˆ†ä¸¤ç§æƒ…å†µè®¨è®ºã€‚

ğŸ‘‰æƒ…å†µä¸€ï¼š$i=j$

$$\begin{align} \frac{\partial a_j}{\partial z_i} &= \frac{\partial a_i}{\partial z_i} \\&=  \frac{e^{z_i} \sum^K_{k=1}e^{z_k} - e^{2z
_i} }{ (\sum^K_{k=1}e^{z_k})^2 } \\&= \frac{e^{z_i}}{\sum^K_{k=1}e^{z_k}} - (\frac{e^{z_i}}{\sum^K_{k=1}e^{z_k}})^2 \\&= a_i-a_i^2 \\&= a_i(1-a_i) \tag{4} \end{align}$$

ğŸ‘‰æƒ…å†µäºŒï¼š$i\neq j$

$$\frac{\partial a_j}{\partial z_i} = -\frac{e^{z_j} e^{z_i}}{(\sum^K_{k=1}e^{z_k})^2} = -a_j a_i \tag{5} $$

ç»“åˆå¼(3)ã€å¼(4)ã€å¼(5)å¯å¾—ï¼š

$$\begin{align} \frac{\partial C}{\partial z_i} &= \sum^K_{k=1} \frac{\partial C}{\partial a_k} \cdot \frac{\partial a_k}{\partial z_i} \tag{6} \\&= -\frac{y_i}{a_i} \cdot a_i(1-a_i) + \sum^K_{k=1,k\neq i} (-\frac{y_k}{a_k}) \cdot (-a_k a_i) \tag{7} \\&= -y_i + y_i a_i + \sum^K_{k=1,k\neq i} y_k a_i \tag{8} \\&= -y_i + a_i (y_i + \sum^K_{k=1,k\neq i} y_k) \tag{9} \\&= a_i - y_i \end{align}$$

* å¼(6)æ˜¯å› ä¸º$a^{[L]}$ä¸­æ¯ä¸ªå…ƒç´ çš„è®¡ç®—éƒ½åŒ…å«äº†$z_i$ã€‚
* å¼(7)ä¸­å°†kåˆ†ä¸º$k=i$å’Œ$k\neq i$ä¸¤ç§æƒ…å†µã€‚$k=i$çš„æƒ…å†µå¯ä»¥ç”¨åˆ°å¼(4)ï¼Œ$k\neq i$çš„æƒ…å†µç”¨åˆ°å¼(5)ã€‚
* å¼(9)ä¸­ï¼Œ$y_i + \sum^K_{k=1,k\neq i} y_k=1$ã€‚è¿™æ˜¯å› ä¸ºKä¸ªç±»åˆ«ä¸­åªæœ‰ä¸€ä¸ªä¸ºæ­£ç¡®ç±»åˆ«ï¼Œå…¶æ ‡ç­¾ä¸º1ï¼Œå…¶ä½™é”™è¯¯ç±»åˆ«æ ‡ç­¾å‡ä¸º0ã€‚

ä½¿ç”¨[å‘é‡åŒ–](http://shichaoxin.com/2019/11/22/æ·±åº¦å­¦ä¹ åŸºç¡€-ç¬¬äº”è¯¾-å‘é‡åŒ–/)æ–¹æ³•ï¼š

$$\frac{\partial C}{\partial z^{[L]} }=a^{[L]}-y$$

å¯ç›´æ¥æ‰©å±•åˆ°å¤šä¸ªæ ·æœ¬çš„æƒ…å†µï¼š

$$\frac{\partial L}{\partial Z^{[L]} }=A^{[L]}-Y$$
