---
layout:     post
title:      ã€PythonåŸºç¡€ã€‘ç¬¬åä¸€è¯¾ï¼šå¤„ç†ç¼ºå¤±å€¼
subtitle:   ç¼ºå¤±å€¼çš„äº§ç”Ÿï¼Œç¼ºå¤±å€¼çš„è¡¨ç¤ºï¼Œæ£€æµ‹ç¼ºå¤±å€¼ï¼Œèˆå¼ƒç¼ºå¤±å€¼ï¼Œå¡«è¡¥ç¼ºå¤±å€¼
date:       2020-02-23
author:     x-jeff
header-img: blogimg/20200223.jpg
catalog: true
tags:
    - Python Series
---
>æœ¬æ–‡ä¸ºåŸåˆ›æ–‡ç« ï¼Œæœªç»æœ¬äººå…è®¸ï¼Œç¦æ­¢è½¬è½½ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚

# 1.ä¾¦æµ‹ç¼ºå¤±å€¼

## 1.1.ç¼ºå¤±å€¼çš„äº§ç”Ÿ

é€šå¸¸ç¼ºå¤±å€¼çš„äº§ç”Ÿæœ‰ä¸¤ä¸ªåŸå› ï¼š

1. **æœºæ¢°ç¼ºå¤±**ï¼šä¾‹å¦‚æœºæ¢°æ•…éšœï¼Œå¯¼è‡´æ•°æ®æ— æ³•è¢«å®Œæ•´ä¿å­˜ã€‚
2. **äººä¸ºç¼ºå¤±**ï¼šä¾‹å¦‚å—è®¿è€…æ‹’ç»é€æ¼éƒ¨åˆ†ä¿¡æ¯ã€‚

ç¼ºå¤±å€¼é€šå¸¸ä¸è®¾ç½®ä¸ºç©ºå€¼ï¼Œè€Œè¡¨ç¤ºä¸º`NaN`ã€‚

## 1.2.ç¼ºå¤±å€¼çš„è¡¨ç¤º

é€šå¸¸å¯ç”¨`numpy.nan`è¡¨ç¤ºç¼ºå¤±å€¼ã€‚

```python
import numpy as np
print(np.nan)#nan
```

## 1.3.æ£€æµ‹ç¼ºå¤±å€¼

æŒ‰ç…§ä¸Šä¸€è¯¾[ã€PythonåŸºç¡€ã€‘ç¬¬åè¯¾ï¼šDataFrameçš„ç›¸å…³æ“ä½œ](http://shichaoxin.com/2020/02/02/PythonåŸºç¡€-ç¬¬åè¯¾-DataFrameçš„ç›¸å…³æ“ä½œ/)ä¸­çš„æ–¹æ³•ï¼Œæ„å»ºä¸€ç»„å«æœ‰ç¼ºå¤±å€¼çš„æ•°æ®ï¼š

```python
import numpy as np
import pandas as pd
#æ„å»ºä¸€ç»„å«æœ‰ç¼ºå¤±å€¼çš„æ•°æ®
df=pd.DataFrame([["Tim","M",24,169,100],["Jack","M",np.nan,177,140],["Jessy","F",21,162,np.nan],["Mary","F",23,159,87]])
#èµ‹äºˆåˆ—å
df.columns=["Name","Gender","Age","Height","Weight"]
print(df)
```

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson11/11x1.png)

ğŸ‘‰æ£€æŸ¥æ˜¯å¦å­˜åœ¨ç¼ºå¤±å€¼ï¼š`.isnull().values.any()`ã€‚

```python
#æ£€æŸ¥ç¬¬1è¡Œæ˜¯å¦å­˜åœ¨ç¼ºå¤±å€¼
print(df.loc[0].isnull().values.any())#è¿”å›Falseè¯´æ˜æ— ç¼ºå¤±å€¼
print(df[0:1].isnull().values.any())#å¦ä¸€ç§è¡¨è¾¾æ–¹å¼ï¼Œä¹Ÿæ˜¯æ£€æŸ¥ç¬¬1è¡Œæ˜¯å¦æœ‰ç¼ºå¤±å€¼
#æ£€æŸ¥ç¬¬3åˆ—æ˜¯å¦å­˜åœ¨ç¼ºå¤±å€¼
print(df["Age"].isnull().values.any())#è¿”å›Trueè¯´æ˜å­˜åœ¨ç¼ºå¤±å€¼
#åˆ¤æ–­æ•´ä¸ªDataFrameä¸­æ˜¯å¦å­˜åœ¨ç¼ºå¤±å€¼
print(df.isnull().values.any())#è¿”å›Trueè¯´æ˜DataFrameä¸­å­˜åœ¨ç¼ºå¤±å€¼
```

ä½†æ˜¯ä¸Šè¿°åªèƒ½è¾“å‡ºæ˜¯å¦æœ‰ç¼ºå¤±å€¼ï¼Œè€Œä¸èƒ½çŸ¥é“ç¼ºå¤±å€¼çš„å…·ä½“ä½ç½®ã€‚

ğŸ‘‰è¾“å‡ºç¼ºå¤±å€¼çš„å…·ä½“ä½ç½®ï¼š`.isnull()`æˆ–`.notnull()`ã€‚

```python
#åˆ¤æ–­ç¬¬4è¡Œç¼ºå¤±å€¼çš„å…·ä½“ä½ç½®
print(df.loc[3].isnull())#Falseä¸ºéç¼ºå¤±å€¼ï¼ŒTrueä¸ºç¼ºå¤±å€¼
print(df.loc[3].notnull())#Falseä¸ºç¼ºå¤±å€¼ï¼ŒTrueä¸ºéç¼ºå¤±å€¼
#åˆ¤æ–­ç¬¬5åˆ—ç¼ºå¤±å€¼çš„å…·ä½“ä½ç½®
print(df["Weight"].isnull())
print(df["Weight"].notnull())
#åˆ¤æ–­æ•´ä¸ªDataFrameä¸­æ˜¯å¦å­˜åœ¨ç¼ºå¤±å€¼
print(df.isnull())
print(df.notnull())
#åŒæ—¶æ£€æŸ¥æ‰€æœ‰åˆ—æ˜¯å¦å­˜åœ¨ç¼ºå¤±å€¼
print(df.isnull().any())
```

ä»¥`print(df.isnull())`ä¸ºä¾‹ï¼Œå…¶è¾“å‡ºä¸ºï¼š

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson11/11x2.png)

`print(df.isnull().any())`è¾“å‡ºä¸ºï¼š

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson11/11x3.png)

ğŸ‘‰ç»Ÿè®¡ç¼ºå¤±å€¼çš„æ•°é‡ï¼š`.isnull().sum()`ã€‚

```python
#ç»Ÿè®¡ç¬¬2è¡Œç¼ºå¤±å€¼çš„æ•°é‡
print(df.loc[1].isnull().sum())#output:1
#ç»Ÿè®¡ç¬¬3åˆ—ç¼ºå¤±å€¼çš„æ•°é‡
print(df["Age"].isnull().sum())#output:1
#æ•´ä¸ªDataFrameç¼ºå¤±å€¼çš„æ•°é‡
print(df.isnull().sum())#æŒ‰åˆ—ç»Ÿè®¡
print(df.isnull().sum().sum())#æ€»è®¡;output:2
```

ä¾‹å¦‚`print(df.isnull().sum())`çš„è¾“å‡ºä¸ºï¼š

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson11/11x4.png)

# 2.å¤„ç†ç¼ºå¤±å€¼

## 2.1.èˆå¼ƒç¼ºå¤±å€¼

å½“ç¼ºå¤±å€¼å æ•°æ®æ¯”ä¾‹å¾ˆä½æ—¶ï¼Œå¯ä»¥ç›´æ¥èˆå¼ƒç¼ºå¤±å€¼ã€‚

æ–°å»ºä¸€ä¸ªDataFrameï¼š

```python
import pandas as pd
import numpy as np
df=pd.DataFrame([["Tim","M",24,169,100],["Jack","M",np.nan,177,np.nan],["Jessy","F",21,162,np.nan],["Mary","F",23,159,87]])
df.columns=["Name","Gender","Age","Height","Weight"]
df["Salary"]=np.nan
print(df)
```

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson11/11x5.png)

èˆå¼ƒç¼ºå¤±å€¼ç”¨åˆ°çš„å‡½æ•°ï¼š`.dropna()`ã€‚

ğŸ‘‰èˆå¼ƒå«æœ‰ç¼ºå¤±å€¼(ç¼ºå¤±å€¼æ•°é‡>0)çš„è¡Œ/åˆ—ï¼š

```python
#èˆå¼ƒå«æœ‰ç¼ºå¤±å€¼çš„è¡Œ
print(df.dropna(axis=0,how="any"))#é»˜è®¤å‚æ•°
#èˆå¼ƒå«æœ‰ç¼ºå¤±å€¼çš„åˆ—
print(df.dropna(axis=1,how="any"))
```

ä¾‹å¦‚`print(df.dropna(axis=1,how="any"))`çš„è¾“å‡ºä¸ºï¼š

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson11/11x6.png)

ğŸ‘‰èˆå¼ƒå…¨éƒ¨ä¸ºç¼ºå¤±å€¼çš„è¡Œ/åˆ—ï¼š

```python
#ä»¥åˆ—ä¸ºä¾‹ï¼šaxis=1
print(df.dropna(axis=1,how="all"))
```

è¾“å‡ºä¸ºï¼š

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson11/11x7.png)

ğŸ‘‰ä»…ä¿ç•™éç¼ºå¤±å€¼æ•°é‡å¤§äºç­‰äºä¸€å®šé˜ˆå€¼çš„è¡Œ/åˆ—ï¼š

```python
#ä»¥è¡Œä¸ºä¾‹ï¼šaxis=0
print(df.dropna(axis=0,thresh=4))
```

å‚æ•°`thresh=4`æŒ‡çš„æ˜¯ä»…ä¿ç•™**éç¼ºå¤±å€¼æ•°é‡å¤§äºç­‰äº**4çš„è¡Œ/åˆ—ã€‚å› æ­¤ä¸Šè¿°ä»£ç çš„è¾“å‡ºä¸ºï¼š

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson11/11x8.png)

## 2.2.å¡«è¡¥ç¼ºå¤±å€¼

é™¤äº†èˆå¼ƒç¼ºå¤±å€¼ï¼Œä¹Ÿå¯ä»¥å¯¹ç¼ºå¤±å€¼è¿›è¡Œäººä¸ºçš„ä¼°è®¡å¹¶å¡«è¡¥ã€‚å¯ä»¥ä½¿ç”¨å‡½æ•°`.fillna()`ã€‚

ä¸»è¦æœ‰ä¸¤ç§æ–¹æ³•ï¼š

1. ä½¿ç”¨å™è¿°æ€§ç»Ÿè®¡å¡«è¡¥ç¼ºå¤±å€¼ã€‚
2. ä½¿ç”¨å†…æ’æ³•å¡«è¡¥ç¼ºå¤±å€¼ã€‚

### 2.2.1.å™è¿°æ€§ç»Ÿè®¡å¡«è¡¥ç¼ºå¤±å€¼

ä½¿ç”¨å¹³å‡æ•°ã€ä¸­ä½æ•°ã€ä¼—æ•°ç­‰å™è¿°æ€§ç»Ÿè®¡å¡«è¡¥ç¼ºå¤±å€¼ã€‚

æœ¬éƒ¨åˆ†å¦‚æ— ç‰¹æ®Šè¯´æ˜ï¼Œé»˜è®¤ä½¿ç”¨2.1éƒ¨åˆ†çš„DataFrameã€‚

#### 2.2.1.1.ç”¨æŸä¸ªå…·ä½“æ•°å€¼å¡«è¡¥ç¼ºå¤±å€¼

ä¾‹å¦‚`print(df.fillna(2))`ä½¿ç”¨æ•°å€¼â€œ2â€æ¥å¡«è¡¥ç¼ºå¤±å€¼ï¼Œå…¶è¾“å‡ºä¸ºï¼š

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson11/11x9.png)

#### 2.2.1.2.ç”¨å¹³å‡å€¼å¡«è¡¥ç¼ºå¤±å€¼

```python
df["Age"].fillna(df["Age"].mean(),inplace=True)
print(df)
```

è¾“å‡ºä¸ºï¼š

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson11/11x10.png)

å‚æ•°`inplace=True`è¡¨ç¤ºç›´æ¥æ›¿æ¢ä¸ºä¿®æ”¹åçš„ç»“æœã€‚

#### 2.2.1.3.ç”¨åˆ†å±‚å¹³å‡å€¼å¡«è¡¥ç¼ºå¤±å€¼

åœ¨2.1éƒ¨åˆ†çš„ä¾‹å­çš„åŸºç¡€ä¸Šå†æ·»åŠ ä¸€æ¡æ•°æ®ï¼š

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson11/11x13.png)

ç°åœ¨æˆ‘ä»¬ç”¨å„æ€§åˆ«å¹´é¾„å¹³å‡å€¼å¡«è¡¥ç¼ºå¤±å€¼ï¼š

```python
#æ–¹å¼ä¸€
df["Age"].fillna(df["Age"].groupby(df["Gender"]).transform("mean"),inplace=True)
print(df)
#æ–¹å¼äºŒ
df["Age"].fillna(df.groupby("Gender")["Age"].transform("mean"),inplace=True)
print(df)
```

ä¸¤ç§æ–¹å¼çš„è¾“å‡ºæ˜¯ä¸€æ ·çš„ï¼Œå‡ä¸ºï¼š

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson11/11x14.png)

>`groupby`å’Œ`transform`çš„è¯¦ç»†ç”¨æ³•è§ç¬¬3éƒ¨åˆ†ã€‚

#### 2.2.1.4.å‘å‰/åå¡«å€¼

ä»¥2.2.1.3éƒ¨åˆ†çš„DataFrameä¸ºä¾‹ï¼Œå»æ‰Salaryåˆ—ï¼š

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson11/11x16.png)

ğŸ‘‰å‘åå¡«è¡¥ç¼ºå¤±å€¼ï¼šç¬¬äºŒè¡Œå‚ç…§ç¬¬ä¸€è¡Œï¼Œç¬¬ä¸‰è¡Œå‚ç…§ç¬¬äºŒè¡Œï¼Œä»¥æ­¤ç±»æ¨ã€‚

```python
#å‘åå¡«è¡¥ç¼ºå¤±å€¼
df.fillna(method="pad",inplace=True)
```

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson11/11x17.png)

ğŸ‘‰å‘å‰å¡«è¡¥ç¼ºå¤±å€¼ï¼šå€’æ•°ç¬¬äºŒè¡Œå‚ç…§æœ€åä¸€è¡Œï¼Œå€’æ•°ç¬¬ä¸‰è¡Œå‚ç…§å€’æ•°ç¬¬äºŒè¡Œï¼Œä»¥æ­¤ç±»æ¨ã€‚

```python
#å‘å‰å¡«è¡¥ç¼ºå¤±å€¼
df.fillna(method="bfill",inplace=True)
```

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson11/11x18.png)

æ­¤å¤–ä¹Ÿå¯ä»¥é™åˆ¶å¡«è¡¥çš„è¡Œæ•°ï¼Œä¾‹å¦‚åœ¨å‘å‰å¡«è¡¥ç¼ºå¤±å€¼æ—¶ï¼Œåªå¡«è¡¥ä¸€è¡Œï¼ˆä»æœ‰ç¼ºå¤±å€¼çš„è¡Œå¼€å§‹ç®—ï¼Œä¸åŒ…å«æœ€åä¸€è¡Œï¼‰ï¼š

```python
#åœ¨å‘å‰å¡«è¡¥ç¼ºå¤±å€¼æ—¶ï¼Œåªå¡«è¡¥ä¸€è¡Œ
df.fillna(method="bfill",inplace=True,limit=1)
```

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson11/11x19.png)

### 2.2.2.å†…æ’æ³•å¡«è¡¥ç¼ºå¤±å€¼

å¦‚æœå­—æ®µæ•°æ®æˆè§„å¾‹åˆ†å¸ƒï¼ˆä¾‹å¦‚çº¿æ€§åˆ†å¸ƒï¼‰ï¼Œå¯ä»¥ä½¿ç”¨å†…æ’æ³•å¡«è¡¥ç¼ºå¤±å€¼ã€‚

æ–°å»ºä¸€ä¸ªDataFrameï¼š

```python
df=pd.DataFrame([[1,870],[2,900],[np.nan,np.nan],[4,950],[5,1000],[6,1200]])
df.columns=["Time","Value"]
print(df)
```

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson11/11x20.png)

ä½¿ç”¨å†…æ’æ³•å¡«è¡¥ç¼ºå¤±å€¼ï¼š

```python
#ä½¿ç”¨å†…æ’æ³•å¡«è¡¥ç¼ºå¤±å€¼
print(df.interpolate())
```

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson11/11x21.png)

å‡½æ•°`.interpolate()`åŒ…å«æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œé»˜è®¤çš„æ˜¯`method="linear"`ã€‚

# 3.`groupby`å’Œ`transform`

æˆ‘ä»¬æ„å»ºä¸€ä¸ªæ–°çš„DataFrameï¼Œè¿™æ¬¡æˆ‘ä»¬ä¸ç”¨ä¹‹å‰`df=pandas.DataFrame([[...],[...],[...]])`çš„è¿™ç§æ–¹æ³•ï¼Œä»‹ç»ä¸€ç§æ–°çš„æ„å»ºDataFrameçš„æ–¹æ³•ï¼š

```python
np.random.seed(1)
df=pd.DataFrame({"key1":list('aabba'),"key2":["one","two","one","two","one"],"data1":np.random.randn(5),"data2":np.random.randn(5)})
print(df)
```

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson11/11x11.png)

æ¯”å¦‚æˆ‘ä»¬ç°åœ¨è¦åˆ†åˆ«æ±‚key1='a'å’Œkey1='b'æ—¶ï¼Œå¯¹åº”çš„data1çš„å¹³å‡æ•°ï¼š

```python
grouped=df["data1"].groupby(df["key1"])
print(grouped.mean())
```

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson11/11x12.png)

é€šå¸¸`transform`å’Œ`groupby`ä¼šç»“åˆèµ·æ¥ç”¨ã€‚å‡è®¾æˆ‘ä»¬ç°åœ¨éœ€è¦å°†æ±‚å¾—çš„åˆ†å±‚å¹³å‡å€¼å¯¹åº”æ”¾å…¥data1ä¸­ï¼Œå°±å¯ä»¥ä½¿ç”¨`transform`å‡½æ•°ï¼š

1. æ–¹å¼ä¸€ï¼š`df["data1"]=df["data1"].groupby(df["key1"]).transform("mean")`
2. æ–¹å¼äºŒï¼š`df["data1"]=df.groupby("key1")["data1"].transform("mean")`

ä¸¤ç§å†™æ³•çš„ç»“æœéƒ½ä¸ºï¼š

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson11/11x15.png)

# 4.ä»£ç åœ°å€

1. [å¤„ç†ç¼ºå¤±å€¼](https://github.com/x-jeff/Python_Code_Demo/tree/master/Demo11)