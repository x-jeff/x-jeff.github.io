---
layout:     post
title:      ã€OpenCVåŸºç¡€ã€‘ç¬¬äºŒåå…­è¯¾ï¼šè½®å»“å‘ç°
subtitle:   è½®å»“å‘ç°ï¼Œcv::findContoursï¼Œcv::drawContours
date:       2021-12-16
author:     x-jeff
header-img: blogimg/20211216.jpg
catalog: true
tags:
    - OpenCV Series
---
>æœ¬æ–‡ä¸ºåŸåˆ›æ–‡ç« ï¼Œæœªç»æœ¬äººå…è®¸ï¼Œç¦æ­¢è½¬è½½ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚

# 1.è½®å»“å‘ç°

**è½®å»“å‘ç°**æ˜¯åŸºäºå›¾åƒè¾¹ç¼˜æå–çš„åŸºç¡€å¯»æ‰¾å¯¹è±¡è½®å»“çš„æ–¹æ³•ã€‚æ‰€ä»¥è¾¹ç¼˜æå–çš„é˜ˆå€¼é€‰å®šä¼šå½±å“æœ€ç»ˆè½®å»“å‘ç°ç»“æœã€‚

# 2.ç›¸å…³API

## 2.1.`cv::findContours`

è¯¥APIæ‰€åŸºäºçš„ç®—æ³•æ¥è‡ªè®ºæ–‡â€œTopological Structural Analysis of Digitized Binary Images by Border Followingâ€ï¼š[åŸæ–‡](https://github.com/x-jeff/AI_Papers/blob/master/Topological%20Structural%20Analysis%20of%20Digitized%20Binary%20Images%20by%20Border%20Following.pdf)ã€[åšå®¢è®²è§£](http://shichaoxin.com/2021/12/03/æ–‡çŒ®é˜…è¯»-Topological-Structural-Analysis-of-Digitized-Binary-Images-by-Border-Following/)ã€‚

```c++
void findContours( 
	InputArray image, 
	OutputArrayOfArrays contours,
	OutputArray hierarchy, 
	int mode,
	int method, 
	Point offset = Point()
);
```

å‚æ•°è¯¦è§£ï¼š

1. `InputArray image`ï¼šè¾“å…¥å›¾åƒï¼Œéœ€ä¸º8-bitå•é€šé“å›¾åƒã€‚å› ä¸ºç®—æ³•æ˜¯åŸºäºäºŒå€¼å›¾åƒè¿›è¡Œè½®å»“æŸ¥æ‰¾ï¼Œæ‰€ä»¥è¿™é‡Œå°†åƒç´ å€¼ä¸ä¸º0çš„è§†ä¸º1ï¼Œåƒç´ å€¼ä¸º0çš„è§†ä¸º0ã€‚
2. `OutputArrayOfArrays contours`ï¼šè¾“å‡ºæ‰¾åˆ°çš„è½®å»“ã€‚æ¯ä¸ªè½®å»“ä¸Šçš„ç‚¹éƒ½åˆ†åˆ«å­˜ä¸ºä¸€ä¸ªvectorï¼Œä¾‹å¦‚ï¼š`std::vector<std::vector<cv::Point> >`ã€‚
3. `OutputArray hierarchy`ï¼šè¾“å‡ºå›¾åƒçš„æ‹“æ‰‘ç»“æ„ï¼Œç±»å‹ä¸º`std::vector<cv::Vec4i>`ï¼ˆ`Vec4i`å³ä¸º`Vec<int,4>`ï¼‰ï¼Œå’Œç¬¬2ä¸ªå‚æ•°ä¸­çš„è½®å»“æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚
	* `hierarchy[i][0]`ï¼šç¬¬iä¸ªè½®å»“çš„åä¸€ä¸ªè½®å»“ã€‚
	* `hierarchy[i][1]`ï¼šç¬¬iä¸ªè½®å»“çš„å‰ä¸€ä¸ªè½®å»“ã€‚
	* `hierarchy[i][2]`ï¼šç¬¬iä¸ªè½®å»“çš„å­è½®å»“ã€‚
	* `hierarchy[i][3]`ï¼šç¬¬iä¸ªè½®å»“çš„çˆ¶è½®å»“ã€‚
	
	å¦‚æœç¬¬iä¸ªè½®å»“æ²¡æœ‰å‰ä¸€ä¸ªã€åä¸€ä¸ªã€å­æˆ–çˆ¶è½®å»“ï¼Œåˆ™å¯¹åº”çš„å€¼ä¼šæ˜¯ä¸€ä¸ªè´Ÿå€¼ã€‚
4. `int mode`ï¼šè½®å»“çš„æ£€ç´¢æ¨¡å¼ï¼Œå…±æœ‰5ç§ï¼š
	* `RETR_EXTERNAL=0`
	* `RETR_LIST=1`
	* `RETR_CCOMP=2`
	* `RETR_TREE=3`
	* `RETR_FLOODFILL=4`
5. `int method`ï¼šå®šä¹‰è½®å»“çš„è¿‘ä¼¼æ–¹æ³•ã€‚å…±æœ‰4ç§ï¼š
	* `CHAIN_APPROX_NONE=1`
	* `CHAIN_APPROX_SIMPLE=2`
	* `CHAIN_APPROX_TC89_L1=3`
	* `CHAIN_APPROX_TC89_KCOS=4`
6. `Point offset`ï¼šåç§»é‡ã€‚æ‰€æœ‰çš„è½®å»“ä¿¡æ¯ç›¸å¯¹äºåŸå§‹å›¾åƒå¯¹åº”ç‚¹çš„åç§»é‡ï¼Œç›¸å½“äºåœ¨æ¯ä¸€ä¸ªæ£€æµ‹å‡ºçš„è½®å»“ç‚¹ä¸ŠåŠ ä¸Šè¯¥åç§»é‡ï¼Œå¹¶ä¸”offsetè¿˜å¯ä»¥æ˜¯è´Ÿå€¼ã€‚è¿™ä¸€å‚æ•°åœ¨ä½¿ç”¨ROIæ—¶éå¸¸æœ‰ç”¨ã€‚

### 2.1.1.å‚æ•°`OutputArray hierarchy`è¯¦è§£

![](https://github.com/x-jeff/BlogImage/raw/master/OpenCVSeries/Lesson26/26x1.png)

ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œä¸€å…±å­˜åœ¨8ä¸ªè½®å»“ï¼š

![](https://github.com/x-jeff/BlogImage/raw/master/OpenCVSeries/Lesson26/26x2.png)

ä¸”æŒ‰ç…§åŒ…å›´å…³ç³»ï¼Œè¿™8ä¸ªè½®å»“å¤„äºä¸åŒç­‰çº§ï¼Œä¾‹å¦‚ï¼š

* ç¬¬0çº§ï¼š0ï¼Œ6ï¼Œ7ã€‚
* ç¬¬1çº§ï¼š1ã€‚
* ç¬¬2çº§ï¼š2ã€‚
* ç¬¬3çº§ï¼š3ã€‚
* ç¬¬4çº§ï¼š4ï¼Œ5ã€‚

è¾“å‡ºçš„hierarchyä¸ºï¼š

```
0 : 6 -11-1
1 : -1 -120
2 : -1 -131
3 : -1 -142
4 : 5 -1-13
5 : -1 4-13
6 : 7 0-1-1
7 : -1 6-1-1
```

ä»¥ç¬¬ä¸€è¡Œä¸ºä¾‹è¿›è¡Œè§£é‡Šï¼Œè½®å»“0ä½äºç¬¬0çº§ï¼š

* å…¶ä¸‹ä¸€ä¸ªè½®å»“ï¼ˆå¿…é¡»ä¸ºåŒä¸€çº§ï¼‰ä¸ºè½®å»“6ï¼ˆæŒ‰ç…§åºå·å¤§å°å¯»æ‰¾ï¼‰ã€‚
* å…¶ä¸Šä¸€ä¸ªè½®å»“ï¼ˆå¿…é¡»ä¸ºåŒä¸€çº§ï¼‰æ²¡æœ‰ï¼Œæ‰€ä»¥ä¸º-1ã€‚
* å…¶å­è½®å»“ä¸ºè½®å»“1ã€‚
* å…¶æ²¡æœ‰çˆ¶è½®å»“ï¼Œæ‰€ä»¥ä¸º-1ã€‚

### 2.1.2.å‚æ•°`int mode`è¯¦è§£

ğŸ‘‰`RETR_EXTERNAL=0`ï¼šåªæ£€æµ‹æœ€å¤–å›´çš„è½®å»“ã€‚

![](https://github.com/x-jeff/BlogImage/raw/master/OpenCVSeries/Lesson26/26x3.png)

```
//hierarchy:
0 : 1 -1-1-1
1 : 2 0-1-1
2 : -1 1-1-1
```

ğŸ‘‰`RETR_LIST=1`ï¼šæ£€æµ‹æ‰€æœ‰çš„è½®å»“ï¼Œä½†æ˜¯ä¸å»ºç«‹ç­‰çº§å…³ç³»ã€‚è¿™å°±æ„å‘³ç€è¿™ä¸ªæ¨¡å¼ä¸‹ä¸å­˜åœ¨çˆ¶è½®å»“å’Œå­è½®å»“ï¼Œå³`hierarchy[i][2]`å’Œ`hierarchy[i][3]`å‡ä¸º-1ã€‚

![](https://github.com/x-jeff/BlogImage/raw/master/OpenCVSeries/Lesson26/26x4.png)

```
//hierarchy:
0 : 1 -1-1-1
1 : 2 0-1-1
2 : 3 1-1-1
3 : 4 2-1-1
4 : 5 3-1-1
5 : 6 4-1-1
6 : 7 5-1-1
7 : -1 6-1-1
```

ğŸ‘‰`RETR_CCOMP=2`ï¼šæ£€æµ‹æ‰€æœ‰çš„è½®å»“ï¼Œä½†åªå»ºç«‹ä¸¤ä¸ªç­‰çº§å…³ç³»ï¼Œå³åŸè®ºæ–‡ä¸­æåˆ°çš„[å¤–è¾¹ç•Œå’Œæ´è¾¹ç•Œ](http://shichaoxin.com/2021/12/03/æ–‡çŒ®é˜…è¯»-Topological-Structural-Analysis-of-Digitized-Binary-Images-by-Border-Following/#2basic-concept-and-notations)ã€‚

![](https://github.com/x-jeff/BlogImage/raw/master/OpenCVSeries/Lesson26/26x5.png)

ä¸Šå›¾ä¸­ï¼Œå¤–è¾¹ç•Œï¼ˆç¬¬0çº§ï¼‰æœ‰6ï¼Œ7ï¼Œ4ï¼Œ2ï¼Œ0ï¼Œ1ï¼›æ´è¾¹ç•Œï¼ˆç¬¬1çº§ï¼‰æœ‰5ï¼Œ3ã€‚

```
//hierarchy:
0 : 1 -1-1-1
1 : 2 0-1-1
2 : 4 13-1
3 : -1 -1-12
4 : 6 25-1
5 : -1 -1-14
6 : 7 4-1-1
7 : -1 6-1-1
```

å› ä¸ºå¤–è¾¹ç•Œä¸ºç¬¬0çº§ï¼Œæ‰€ä»¥ä¸å­˜åœ¨çˆ¶è½®å»“ã€‚

ğŸ‘‰`RETR_TREE=3`ï¼šè¾“å‡ºç»“æœè§2.1.1éƒ¨åˆ†ã€‚

### 2.1.3.å‚æ•°`int method`è¯¦è§£

ğŸ‘‰`CHAIN_APPROX_NONE=1`ï¼šä¿å­˜è¾¹ç•Œä¸Šæ‰€æœ‰è¿ç»­çš„è½®å»“ç‚¹åˆ°å‚æ•°`OutputArrayOfArrays contours`ï¼š

![](https://github.com/x-jeff/BlogImage/raw/master/OpenCVSeries/Lesson26/26x6.png)

ğŸ‘‰`CHAIN_APPROX_SIMPLE=2`ï¼šä»…ä¿å­˜è½®å»“çš„æ‹ç‚¹åˆ°å‚æ•°`OutputArrayOfArrays contours`ï¼š

![](https://github.com/x-jeff/BlogImage/raw/master/OpenCVSeries/Lesson26/26x7.png)

ğŸ‘‰`CHAIN_APPROX_TC89_L1=3`å’Œ`CHAIN_APPROX_TC89_KCOS=4`å¼•è‡ªè®ºæ–‡ï¼šC. -. Teh and R. T. Chin, "On the detection of dominant points on digital curves," in IEEE Transactions on Pattern Analysis and Machine Intelligence, vol. 11, no. 8, pp. 859-872, Aug. 1989, doi: 10.1109/34.31447.ã€‚åœ¨æ­¤ä¸å†è¯¦è¿°ã€‚

## 2.2.`cv::drawContours`

`cv::drawContours`é€šå¸¸æ­é…`cv::findContours`ä¸€èµ·ä½¿ç”¨ï¼Œç”¨äºå°†æ£€æµ‹çš„è½®å»“ç»˜åˆ¶å‡ºæ¥ã€‚

```c++
void drawContours( 
	InputOutputArray image, 
	InputArrayOfArrays contours,
	int contourIdx, 
	const Scalar& color,
	int thickness = 1, 
	int lineType = LINE_8,
	InputArray hierarchy = noArray(),
	int maxLevel = INT_MAX, 
	Point offset = Point() 
);
```

å‚æ•°è¯¦è§£ï¼š

1. `InputOutputArray image`ï¼šåœ¨æ­¤å›¾åƒä¸Šç»˜åˆ¶è½®å»“ã€‚
2. `InputArrayOfArrays contours`ï¼šæ£€æµ‹åˆ°çš„è½®å»“ã€‚
3. `int contourIdx`ï¼šæŒ‡å®šè¦ç»˜åˆ¶çš„è½®å»“çš„åºå·ã€‚å¦‚æœä¸ºè´Ÿå€¼ï¼Œåˆ™ç»˜åˆ¶æ‰€æœ‰çš„è½®å»“ã€‚
4. `const Scalar& color`ï¼šç»˜åˆ¶è½®å»“æ‰€ç”¨çš„é¢œè‰²ã€‚
5. `int thickness = 1`ï¼šç»˜åˆ¶è½®å»“æ‰€ç”¨çš„çº¿å®½ã€‚
6. `int lineType = LINE_8`ï¼šç»˜åˆ¶è½®å»“æ‰€ç”¨çš„çº¿ç±»å‹ã€‚
7. `InputArray hierarchy = noArray()`ï¼šå³`cv::findContours`è¾“å‡ºçš„hierarchyã€‚
8. `int maxLevel = INT_MAX`ï¼šé™åˆ¶æ‰€ç»˜åˆ¶è½®å»“çš„çº§åˆ«ã€‚ä¾‹å¦‚maxLevel=3ï¼Œåˆ™åªç»˜åˆ¶ç¬¬0,1,2çº§çš„è½®å»“ã€‚å¦‚æœmaxLevel=0ï¼Œåˆ™ç»˜åˆ¶æŸä¸€ç‰¹å®šåºå·çš„è½®å»“ã€‚
9. `Point offset = Point()`ï¼šè½®å»“çš„åç§»é‡ã€‚

å¦‚æœå‚æ•°`int thickness`<0ï¼Œåˆ™å¡«å……è½®å»“åŒ…å›´çš„éƒ¨åˆ†ï¼š

![](https://github.com/x-jeff/BlogImage/raw/master/OpenCVSeries/Lesson26/26x8.png)

# 3.ä»£ç åœ°å€

1. [è½®å»“å‘ç°](https://github.com/x-jeff/OpenCV_Code_Demo/tree/master/Demo26)

# 4.å‚è€ƒèµ„æ–™

1. [findContourså‡½æ•°å‚æ•°è¯¦è§£](https://blog.csdn.net/dcrmg/article/details/51987348)
2. [opencv cv.findContours å‡½æ•°è¯¦è§£ å›¾åƒè½®å»“å±‚çº§ å›¾åƒè½®å»“æ£€ç´¢æ–¹å¼è¯¦è§£](https://www.cnblogs.com/wojianxin/p/12602490.html)