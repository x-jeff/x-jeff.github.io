---
layout:     post
title:      ã€PythonåŸºç¡€ã€‘ç¬¬å…«è¯¾ï¼šç½‘ç»œçˆ¬è™«
subtitle:   ç½‘ç»œçˆ¬è™«æ¶æ„ï¼Œå¼€å‘è€…å·¥å…·ï¼ŒBeautifulSoup
date:       2019-11-05
author:     x-jeff
header-img: blogimg/20191105.jpg
catalog: true
tags:
    - Python Series
---
>æœ¬æ–‡ä¸ºåŸåˆ›æ–‡ç« ï¼Œæœªç»æœ¬äººå…è®¸ï¼Œç¦æ­¢è½¬è½½ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚

# 1.ç½‘ç»œçˆ¬è™«æ¶æ„

ğŸ‘‰ç½‘é¡µç¼–å†™çš„å‡ ä¸ªé‡è¦å…ƒç´ ï¼š

1. **ã€htmlã€‘**ä¸­æ–‡å…¨ç§°ä¸º**è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€**ï¼Œç±»ä¼¼äºxmlæ ¼å¼ã€‚
	* **è¶…æ–‡æœ¬**ï¼šæŒ‡é¡µé¢å†…çš„å›¾ç‰‡ã€é“¾æ¥ï¼Œç”šè‡³éŸ³ä¹ã€ç¨‹åºç­‰éæ–‡å­—å…ƒç´ ã€‚
	* htmlçš„ç»“æ„åŒ…æ‹¬**â€œå¤´(head)â€**éƒ¨åˆ†å’Œ**â€œä¸»ä½“(body)â€**éƒ¨åˆ†ï¼Œå…¶ä¸­â€œå¤´â€éƒ¨åˆ†æä¾›å…³äºç½‘é¡µçš„ä¿¡æ¯ï¼Œâ€œä¸»ä½“â€éƒ¨åˆ†æä¾›ç½‘é¡µçš„å…·ä½“å†…å®¹ã€‚
2. **ã€cssã€‘**ä¸­æ–‡å…¨ç§°ä¸º**å±‚å æ ·å¼è¡¨**ï¼ˆå¯ä»¥ç†è§£ä¸ºç½‘é¡µçš„åŒ–å¦†å“ï¼Œç”¨äºç¾åŒ–ç½‘é¡µï¼‰ã€‚cssæ˜¯ä¸€ç§å®šä¹‰æ ·å¼ç»“æ„å¦‚å­—ä½“ã€é¢œè‰²ã€ä½ç½®ç­‰çš„è¯­è¨€ã€‚
3. **ã€JavaScriptã€‘**å¸¸ç”¨æ¥ä¸ºç½‘é¡µæ·»åŠ å„å¼å„æ ·çš„åŠ¨æ€åŠŸèƒ½ï¼ˆä»¥åŠäº¤äº’è¡Œä¸ºï¼‰ã€‚

æ‰“å¼€chromeæµè§ˆå™¨ï¼Œè¿›å…¥æŸä¸€ç½‘ç«™ï¼Œé€‰æ‹©**å¼€å‘è€…å·¥å…·**ï¼š

![](https://github.com/x-jeff/BlogImage/raw/master/PythonSeries/Lesson8/8x1.png)

ä¸‹é¢ä¾æ¬¡ä»‹ç»å¸¸ç”¨çš„å‡ ä¸ªçª—å£ï¼š

1. **Elements**ï¼šhtmlè¯­è¨€ã€‚
	* **Styles**ï¼šcssæ ¼å¼ã€‚  
![](https://github.com/x-jeff/BlogImage/raw/master/PythonSeries/Lesson8/8x2.png)
	* ç‚¹å‡»å·¦ä¸Šè§’çš„ç®­å¤´å›¾æ ‡ï¼Œå¯æŸ¥çœ‹ç½‘é¡µå„ä¸ªå†…å®¹å¯¹åº”çš„htmlä»£ç ï¼Œå¹¶åœ¨æœ¬åœ°ä½œå‡ºä¿®æ”¹ï¼Œä¾‹å¦‚ï¼š    
![](https://github.com/x-jeff/BlogImage/raw/master/PythonSeries/Lesson8/8x6.png)
2. **Console**ï¼šç¼–å†™JaveScriptã€‚ä¾‹å¦‚è¾“å…¥`$('a').remove`ï¼Œå»æ‰ç½‘é¡µæ‰€æœ‰é“¾æ¥ã€‚
3. **Sources**ï¼šç½‘é¡µæºä»£ç ã€‚
4. **Timeline**ï¼šè½½å…¥é¡ºåºã€‚
5. **Network**ï¼šå…³æ³¨ç½‘é¡µçš„ä¸€ä¸¾ä¸€åŠ¨ã€‚
	* Allï¼šå‘ç”Ÿçš„è¯·æ±‚ï¼ˆå„ç§ç±»å‹çš„è¯·æ±‚ï¼šcssï¼Œjsè„šæœ¬ï¼Œå›¾ç‰‡ï¼Œæ–‡å­—ç­‰ï¼‰ã€‚
	* Docï¼šç½‘é¡µçš„æ–‡å­—ä¿¡æ¯ï¼ˆ99%çš„æ–‡å­—ä¿¡æ¯éƒ½åœ¨è¿™é‡Œï¼Œå‰©ä¸‹çš„1%å¯èƒ½åœ¨â€œHDRâ€æˆ–â€œJSâ€ï¼‰ã€‚
	* Responseï¼šhtmlè¯­è¨€ï¼ˆç½‘é¡µå›åº”ä¿¡æ¯ï¼‰   
![](https://github.com/x-jeff/BlogImage/raw/master/PythonSeries/Lesson8/8x3.png)

ç½‘ç»œçˆ¬è™«æ¶æ„ï¼š

![](https://github.com/x-jeff/BlogImage/raw/master/PythonSeries/Lesson8/8x4.png)

# 2.è·å–ç½‘é¡µæ–‡å­—èµ„è®¯

å®‰è£…ä»¥ä¸‹ä¸¤ä¸ªåŒ…ï¼š

1. `pip install requests`
2. `pip install BeautifulSoup4`

æˆ–è€…ç›´æ¥å®‰è£…Anaconda(Anacondaä¸­åŒ…å«è¿™ä¸¤ä¸ªåŒ…)ã€‚

å‡è®¾æˆ‘ä»¬ç°åœ¨è·å–è…¾è®¯æ–°é—»ä¸»é¡µçš„æ–‡å­—ä¿¡æ¯ï¼š

```python
import requests
newsurl='http://news.qq.com/'
res=requests.get(newsurl)
print(res.text)
```

ç»“æœéƒ¨åˆ†æˆªå›¾è§ä¸‹ï¼š

![](https://github.com/x-jeff/BlogImage/raw/master/PythonSeries/Lesson8/8x7.png)

å¾—åˆ°çš„æ˜¯htmlæ ¼å¼çš„æ•°æ®ï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥å°†æœ‰ç”¨çš„ä¿¡æ¯è¿›è¡Œè¿›ä¸€æ­¥çš„æå–ï¼Œå»æ‰ç¹ççš„æ ¼å¼ã€‚

# 3.BeautifulSoupçš„ä½¿ç”¨

## 3.1.DOM Tree

å‡è®¾æˆ‘ä»¬æœ‰å¦‚ä¸‹htmlæ ¼å¼çš„æ•°æ®ï¼š

```html
<html>
<body>
<h1 id="title">Hello World</h1>
<a href="#" class="link">This is link1</a>
<a href="# link2" class="link">This is link2</a>
</body>
</html>
```

å…¶ä¸­h1æ˜¯å¤§æ ‡é¢˜ï¼Œä¸¤ä¸ªaæ˜¯å¯¹åº”ä¸¤ä¸ªé“¾æ¥ï¼Œhrefä¸ºé“¾æ¥çš„åœ°å€ã€‚

BeautifulSoupå¯å°†htmlæ•°æ®è§£ææˆDOM(Document Object Model) Treeï¼š

![](https://github.com/x-jeff/BlogImage/raw/master/PythonSeries/Lesson8/8x8.png)

## 3.2.ä½¿ç”¨BeautifulSoupè§£æhtmlæ•°æ®

ä½¿ç”¨BeautifulSoupè§£æä¸Šè¿°çš„htmlæ•°æ®ï¼š

```python
from bs4 import BeautifulSoup
html_sample='\
<html>\
<body>\
<h1 id="title">Hello World</h1>\
<a href="#" class="link">This is link1</a>\
<a href="# link2" class="link">This is link2</a>\
</body>\
</html>'
soup=BeautifulSoup(html_sample,'html.parser')
print(soup.text)
```

>`\`å¯ç”¨äºè¾ƒé•¿çš„å­—ç¬¦ä¸²æ¢è¡Œã€‚

å‡½æ•°`BeautifulSoup()`ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºhtmlæ•°æ®ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºè§£æå™¨çš„ç±»å‹ï¼Œå¯ä»¥æ˜¯html.parserï¼Œä¹Ÿå¯ä»¥æ˜¯html5lib.parserã€lxml.parserç­‰ç­‰ï¼Œä¸åŒçš„è§£æå™¨æœ‰ä¸åŒçš„ä¼˜ç¼ºç‚¹ã€‚è¿™é‡Œä½¿ç”¨html.parserã€‚

ä¸Šè¿°ä»£ç è¾“å‡ºä¸ºï¼š

![](https://github.com/x-jeff/BlogImage/raw/master/PythonSeries/Lesson8/8x9.png)

è¿”å›äº†ä¸€ä¸ªå­—ç¬¦ä¸²æ ¼å¼çš„æ•°æ®ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬çˆ¬å–äº†æ•°æ®ä¸­æ‰€æœ‰çš„æ–‡å­—ä¿¡æ¯ã€‚

## 3.3.æ‰¾å‡ºæ‰€æœ‰å«ç‰¹å®šæ ‡ç­¾çš„htmlå…ƒç´ 

ğŸ‘‰é‚£ä¹ˆå¦‚æœæˆ‘ä»¬æƒ³çˆ¬å–æŸä¸ªç‰¹å®štagè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ

```python
header=soup.select('h1')
print(header)

alink=soup.select('a')
print(alink)
```

è¾“å‡ºä¸ºï¼š

![](https://github.com/x-jeff/BlogImage/raw/master/PythonSeries/Lesson8/8x10.png)

è¿”å›çš„ä¸ºåˆ—è¡¨ç»“æ„çš„æ•°æ®ã€‚

ğŸ‘‰è¿›ä¸€æ­¥çˆ¬å–ç‰¹å®štagä¸‹çš„elementï¼š

```python
print(soup.select('h1')[0].text)
for xx in alink:
    print(xx.text)
```

è¾“å‡ºä¸ºï¼š

![](https://github.com/x-jeff/BlogImage/raw/master/PythonSeries/Lesson8/8x11.png)

## 3.4.å–å¾—å«æœ‰ç‰¹å®šcsså±æ€§çš„å…ƒç´ 

ğŸ‘‰ä½¿ç”¨selectæ‰¾å‡ºæ‰€æœ‰idä¸ºtitleçš„å…ƒç´ ï¼ˆâš ï¸idå‰é¢éœ€è¦åŠ #ï¼‰:

```python
alink=soup.select('#title')
```

è¾“å‡ºä¸ºåˆ—è¡¨ç»“æ„çš„æ•°æ®ï¼š`[<h1 id="title">Hello World</h1>]`

ğŸ‘‰ä½¿ç”¨selectæ‰¾å‡ºæ‰€æœ‰classä¸ºlinkçš„å…ƒç´ ï¼ˆâš ï¸classå‰é¢éœ€åŠ .ï¼‰:

```python
for link in soup.select('.link'):
    print(link)
```

è¾“å‡ºä¸ºï¼š

```
<a class="link" href="#">This is link1</a>
<a class="link" href="# link2">This is link2</a>
```

>idæ˜¯å”¯ä¸€çš„ï¼Œä½†æ˜¯classæ˜¯å¤šæ¬¡é‡å¤å‡ºç°çš„ã€‚

## 3.5.å–å¾—æ ‡ç­¾å†…çš„å±æ€§å€¼

ğŸ‘‰ä½¿ç”¨selectæ‰¾å‡ºæ‰€æœ‰a tagçš„hrefå’Œclassï¼š

```python
alinks=soup.select('a')
for link in alinks :
    print(link['href'])
    print(link['class'])
```

è¾“å‡ºä¸ºï¼š

```
#
['link']
# link2
['link']
```

å–å¾—æŸä¸€ä¸ªtagä¸‹çš„æŸä¸€å±æ€§å€¼ï¼š

```python
alinks[0]['href'] #è¾“å‡ºä¸ºï¼šâ€˜#â€™ã€‚ä¸ºå­—ç¬¦ä¸²æ ¼å¼ã€‚
alinks[0]['class'] #è¾“å‡ºä¸ºï¼š['link']ã€‚ä¸ºåˆ—è¡¨ç»“æ„ã€‚
```

# 4.ç½‘ç»œçˆ¬è™«åŸºæœ¬æ€è·¯

ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦çˆ¬å–è…¾è®¯æ–°é—»ç½‘ç«™([https://news.qq.com/](https://news.qq.com/))ä¸­æ–°é—»çš„æ ‡é¢˜ï¼Œä½¿ç”¨chromeæµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·ç¡®å®šæ–°é—»æ ‡é¢˜çš„ä½ç½®ï¼š

![](https://github.com/x-jeff/BlogImage/raw/master/PythonSeries/Lesson8/8x12.png)

ç„¶åé€šè¿‡ç¬¬3éƒ¨åˆ†æ‰€è®²çš„BeautifulSoupç›¸å…³çŸ¥è¯†ï¼Œå°†å…¶æ–‡å­—å†…å®¹çˆ¬å–ä¸‹æ¥ã€‚

# 5.å®æˆ˜åº”ç”¨--åŒ—äº¬æˆ¿å±‹èµ„æ–™æ”¶é›†

å‡è®¾æˆ‘ä»¬ç°åœ¨éœ€è¦æ”¶é›†åŒ—äº¬çš„æ–°æˆ¿çš„æˆ¿ä»·ä¿¡æ¯ã€‚é¦–å…ˆæ‰“å¼€[åŒ—äº¬æˆ¿å¤©ä¸‹ç½‘ç«™](https://bj.fang.com/)ï¼Œè¿›å…¥â€œæ–°æˆ¿â€ç•Œé¢ã€‚è¿›å…¥å¼€å‘è€…æ¨¡å¼ï¼ŒæŸ¥çœ‹æ–‡å­—ä¿¡æ¯çš„å­˜å‚¨ä½ç½®ï¼š

![](https://github.com/x-jeff/BlogImage/raw/master/PythonSeries/Lesson8/8x13.png)

å¯ä»¥çœ‹å‡ºä¸‰ä¸ªé“¾æ¥ä¸­åªæœ‰ç¬¬ä¸€ä¸ªé“¾æ¥ä¸­å­˜æ”¾ç€ç½‘é¡µçš„æ–‡å­—ä¿¡æ¯ï¼š[https://newhouse.fang.com/house/s/](https://newhouse.fang.com/house/s/)ã€‚

çˆ¬å–åŒ—äº¬æ–°æˆ¿çš„æˆ¿ä»·ä¿¡æ¯ï¼š`res=requests.get('https://newhouse.fang.com/house/s/')`ã€‚

>åœ¨ç¬¬2éƒ¨åˆ†è®²è¿‡æå–ç½‘ç«™çš„æ–‡å­—ä¿¡æ¯æ—¶å¯ä»¥ç”¨`requests.get()`ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼šæŠ“å–çš„å†…å®¹å’Œç½‘é¡µçš„å®æ—¶å†…å®¹å¯èƒ½ä¸åŒï¼Œå› ä¸ºç½‘é¡µçš„å†…å®¹å¯èƒ½æ˜¯ä¸€ç›´åœ¨å®æ—¶åˆ·æ–°ï¼Œè€ŒæŠ“å–çš„å†…å®¹åˆ™åªæ˜¯æŠ“å–æ“ä½œé‚£ä¸ªæ—¶é—´ç‚¹æ—¶ç½‘é¡µçš„å†…å®¹ã€‚

âš ï¸æ­¤æ—¶çˆ¬å–çš„å†…å®¹ä¸­ä¸­æ–‡å¯èƒ½ä¼šå‡ºç°ä¹±ç çš„æƒ…å†µï¼Œéœ€è¦ç‰¹å®šçš„ç¼–ç æ–¹å¼ã€‚ä¸€èˆ¬ç½‘é¡µçš„ç¼–ç æ–¹å¼å¯åœ¨ä¸‹é¢ä¸¤ä¸ªåœ°æ–¹æ‰¾åˆ°ï¼š

1. ![](https://github.com/x-jeff/BlogImage/raw/master/PythonSeries/Lesson8/8x14.png)
2. ![](https://github.com/x-jeff/BlogImage/raw/master/PythonSeries/Lesson8/8x15.png)

å¯ä»¥çœ‹å‡ºæœ¬ä¾‹ä¸­ç½‘é¡µçš„ç¼–ç æ–¹å¼ä¸º"gb2312"ï¼Œé€šè¿‡`res.encoding='gb2312'`æ—¢å¯è§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜ã€‚

ç„¶åé€šè¿‡ç‚¹å‡»å¼€å‘è€…æ¨¡å¼å·¦ä¸Šè§’çš„ç®­å¤´å›¾æ ‡è¿›è¡Œå†…å®¹çš„å…·ä½“å®šä½ï¼ˆå…·ä½“è¯·è§ç¬¬1éƒ¨åˆ†çš„è®²è§£ï¼‰ã€‚æœ¬ä¾‹ä¸­æˆ¿å±‹çš„åç§°å‡åœ¨`class="nlcd_name"`çš„æ ‡ç­¾ä¸‹ï¼š

```python
soup=BeautifulSoup(res.text,'html.parser')
for house_name in soup.select('.nlcd_name'):
    print(house_name.text.strip())
```

è‡³æ­¤ï¼Œæˆ‘ä»¬ä¾¿å¾—åˆ°äº†è¯¥é¡µé¢æ‰€æœ‰çš„æˆ¿å±‹åç§°ï¼š

![](https://github.com/x-jeff/BlogImage/raw/master/PythonSeries/Lesson8/8x16.png)

å¦‚æœæˆ‘ä»¬é™¤äº†è¾“å‡ºæˆ¿å±‹çš„åç§°ï¼Œè¿˜æƒ³å¾—åˆ°è¯¥æˆ¿å±‹ä¿¡æ¯çš„ç½‘ç»œé“¾æ¥ã€‚

![](https://github.com/x-jeff/BlogImage/raw/master/PythonSeries/Lesson8/8x17.png)

æ ¹æ®ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œæˆ¿å±‹çš„é“¾æ¥hrefåœ¨æ ‡ç­¾aä¸­ï¼Œæ˜¯æ ‡ç­¾divçš„å­æ ‡ç­¾ï¼Œå¹¶ä¸”è¯¥é“¾æ¥éœ€è¦åœ¨å‰é¢åŠ ä¸Š`https:`ï¼š

```python
for house_url in soup.select('.nlcd_name a'):
    print('https:' + house_url['href'])
```

è¾“å‡ºè§ä¸‹ï¼š

![](https://github.com/x-jeff/BlogImage/raw/master/PythonSeries/Lesson8/8x18.png)

â—ï¸`.nlcd_name a`ä¸­é—´çš„ç©ºæ ¼è¡¨ç¤ºæ ‡ç­¾aæ˜¯class="nlcd_name"æ‰€åœ¨æ ‡ç­¾çš„å­æ ‡ç­¾ã€‚

â—ï¸ä½†æ˜¯æœ‰ä¸€ç§ç‰¹æ®Šçš„æƒ…å†µï¼Œå¦‚æœclass="info rel floatr"ã€‚å¦‚æœç›´æ¥`soup.select('.info rel floatr')`ï¼Œä¼šè¢«è®¤ä¸º.infoã€relã€floaträ¸‰ä¸ªæ ‡ç­¾æ˜¯å±‚å±‚é€’è¿›çš„å…³ç³»ï¼Œåˆ™è¾“å‡ºä¸ºåŒ¹é…ï¼Œåªèƒ½è¾“å‡ºç©ºå€¼ã€‚è¿™ç§æƒ…å†µæ­£ç¡®çš„å†™æ³•ä¸ºï¼š`soup.select('.info.rel.floatr')`

ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è¾“å‡ºæˆ¿å±‹çš„ä»·é’±ï¼Œæˆ·å‹ï¼Œåœ°å€ç­‰ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯éƒ½å¯ä»¥å°è£…åœ¨ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œæ–¹ä¾¿è°ƒç”¨ã€‚æœ€ç»ˆçš„ç»“æœå¯ä»¥å­˜å‚¨åœ¨DataFrameä¸­ï¼Œè¿›ä¸€æ­¥ä¸ºå¯¼å‡ºä¸ºexcelæˆ–å…¶ä»–æ ¼å¼ï¼š

![](https://github.com/x-jeff/BlogImage/raw/master/PythonSeries/Lesson8/8x19.png)

# 6.ä»£ç åœ°å€

1. [ç½‘ç»œçˆ¬è™«](https://github.com/x-jeff/Python_Code_Demo/tree/master/Demo8)