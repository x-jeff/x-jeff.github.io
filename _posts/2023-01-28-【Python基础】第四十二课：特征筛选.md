---
layout:     post
title:      ã€PythonåŸºç¡€ã€‘ç¬¬å››åäºŒè¯¾ï¼šç‰¹å¾ç­›é€‰
subtitle:   VarianceThreshold()ï¼ŒSelectKBest()ï¼ŒRFE()ï¼Œfeature_importances_
date:       2023-01-28
author:     x-jeff
header-img: blogimg/20200214.jpg
catalog: true
tags:
    - Python Series
---
>æœ¬æ–‡ä¸ºåŸåˆ›æ–‡ç« ï¼Œæœªç»æœ¬äººå…è®¸ï¼Œç¦æ­¢è½¬è½½ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚

# 1.ç§»é™¤ä½å˜å¼‚æ•°çš„ç‰¹å¾

æˆ‘ä»¬å¯¹å¦‚ä¸‹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œcustomer_behavior.csvï¼š

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson42/42x1.png)

å‰å››åˆ—ä¸ºå±æ€§ï¼Œç¬¬äº”åˆ—ä¸ºæ ‡ç­¾ã€‚æˆ‘ä»¬å¯¹å‰å››åˆ—è¿›è¡Œç‰¹å¾ç­›é€‰ï¼š

```python
import pandas
from sklearn.feature_selection import VarianceThreshold
df = pandas.read_csv("customer_behavior.csv")
X = df[['bachelor','gender','age','salary']]
sel = VarianceThreshold()
X_val = sel.fit_transform(X)

names = X.columns[sel.get_support()]
print(names) #è¾“å‡ºä¸ºï¼šIndex(['gender', 'age', 'salary'], dtype='object')
```

å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æŠŠå±æ€§â€œbachelorâ€è¿‡æ»¤æ‰äº†ï¼Œè¯´æ˜å…¶ä¸æ˜¯ä¸€ä¸ªé‡è¦çš„ç‰¹å¾ã€‚`VarianceThreshold()`é€šè¿‡è®¡ç®—æ¯ä¸ªå±æ€§çš„æ–¹å·®ï¼Œå°†æ–¹å·®å°äºé˜ˆå€¼ï¼ˆé»˜è®¤æ˜¯0ï¼‰çš„å±æ€§è¿‡æ»¤æ‰ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œ4ä¸ªå±æ€§çš„æ–¹å·®åˆ†åˆ«ä¸ºï¼š

```python
print(sel.variances_)
#è¾“å‡ºä¸ºï¼š[0.00000000e+00 2.22222222e-01 3.04722222e+01 1.18520833e+06]
```

# 2.å•å˜é‡ç‰¹å¾é€‰æ‹©

```python
from sklearn.feature_selection import SelectKBest
from sklearn.feature_selection import chi2
X = df[['bachelor','gender','age','salary']]
y = df['purchased'].values
clf = SelectKBest(chi2, k=2)
clf.fit(X, y)
print(clf.scores_)

X_new = clf.fit_transform(X, y)
print(X_new)
```

è¾“å‡ºä¸ºï¼š

```
[   0.            0.            4.48447205 2766.66666667]
[[  23 1500]
 [  30 2500]
 [  32 1800]
 [  25 1700]
 [  27 1200]
 [  26 1000]
 [  35 3500]
 [  23 2000]
 [  22 1800]
 [  21 1700]
 [  38 5000]
 [  20 1200]]
```

æˆ‘ä»¬ä½¿ç”¨`SelectKBest`é€‰æ‹©æœ€ä½³çš„Kä¸ªç‰¹å¾ï¼Œæœ¬ä¾‹ä¸­ï¼Œç‰¹å¾å¥½åçš„è¯„åˆ¤æ ‡å‡†ä¸º`chi2`ï¼Œå³[å¡æ–¹æ£€éªŒ](http://shichaoxin.com/2019/01/30/æœºå™¨å­¦ä¹ åŸºç¡€-ç¬¬å››è¯¾-ç»Ÿè®¡å­¦çŸ¥è¯†ä¹‹å‡è®¾æ£€éªŒ/#5éå‚æ•°æ£€éªŒä¹‹chi2æ£€éªŒ)ã€‚æœ¬ä¾‹ä¸­é€‰æ‹©çš„ä¸¤ä¸ªæœ€ä½³ç‰¹å¾æ˜¯â€œageâ€å’Œâ€œsalaryâ€ã€‚

# 3.æš´åŠ›æ³•é€‰æ‹©ç‰¹å¾

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson42/42x2.png)

ç›´æ¥æšä¸¾æ‰€æœ‰çš„ç‰¹å¾ç»„åˆè¿‡äºç¹çï¼Œæ‰€ä»¥ä»‹ç»ä»¥ä¸‹ä¸€ç§ä¼˜åŒ–æ–¹å¼ã€‚

## 3.1.recursive feature elimination

é€æ­¥å‰”é™¤ç‰¹å¾ä»¥æ‰¾åˆ°æœ€å¥½çš„ç‰¹å¾ç»„åˆã€‚

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson42/42x3.png)

ä»£ç å®ç°ï¼š

```python
from sklearn.feature_selection import RFE
from sklearn.svm import SVC
clf = SVC(kernel='linear')
rfe = RFE(clf, n_features_to_select=1)
rfe.fit(X_val, y)
for x in rfe.ranking_:
    print(names[x-1], rfe.ranking_[x-1])
```

è¾“å‡ºä¸ºï¼š

```
salary 1
age 2
gender 3
```

ä½¿ç”¨SVMæ¨¡å‹çš„ç»“æœä½œä¸ºç‰¹å¾ç»„åˆçš„è¯„ä»·æ ‡å‡†ï¼Œ`SVC()`çš„è®²è§£è¯·è§[ã€PythonåŸºç¡€ã€‘ç¬¬äºŒåä¹è¯¾ï¼šåˆ†ç±»æ¨¡å‹ä¹‹SVM](http://shichaoxin.com/2021/11/13/PythonåŸºç¡€-ç¬¬äºŒåä¹è¯¾-åˆ†ç±»æ¨¡å‹ä¹‹SVM/)ã€‚`n_features_to_select`ä¸ºè¦æŒ‘é€‰å‡ºçš„ç‰¹å¾æ•°é‡ã€‚

# 4.ä½¿ç”¨éšæœºæ£®æ—ç­›é€‰å˜é‡

```python
from sklearn.ensemble import RandomForestClassifier
clf = RandomForestClassifier(n_estimators=10,random_state=123)

clf.fit(X_val, y)
for feature in zip(names,clf.feature_importances_):
    print(feature)
```

è¾“å‡ºä¸ºï¼š

```
('gender', 0.0933015873015873)
('age', 0.39391203703703703)
('salary', 0.5127863756613757)
```

`RandomForestClassifier()`çš„è®²è§£è¯·è§ï¼š[ã€PythonåŸºç¡€ã€‘ç¬¬ä¸‰åä¸€è¯¾ï¼šåˆ†ç±»æ¨¡å‹ä¹‹éšæœºæ£®æ—](http://shichaoxin.com/2021/12/12/PythonåŸºç¡€-ç¬¬ä¸‰åä¸€è¯¾-åˆ†ç±»æ¨¡å‹ä¹‹éšæœºæ£®æ—/)ã€‚

ğŸ‘‰å¯è§†åŒ–å‘ˆç°Feature Importanceï¼š

```python
import matplotlib.pyplot as plt
plt.title('Feature Importance')
plt.bar(range(0,len(names)),clf.feature_importances_)
plt.xticks(range(0,len(names)),names)
plt.show()
```

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson42/42x4.png)

# 5.ä»£ç åœ°å€

1. [ç‰¹å¾ç­›é€‰](https://github.com/x-jeff/Python_Code_Demo/tree/master/Demo42)