---
layout:     post
title:      ã€PythonåŸºç¡€ã€‘ç¬¬åå…«è¯¾ï¼šæ—¶äº‹æ–°é—»èµ„æ–™çš„çˆ¬å–å’Œå¤„ç†
subtitle:   ç½‘ç»œçˆ¬è™«ï¼Œæ•°æ®å¤„ç†
date:       2021-02-15
author:     x-jeff
header-img: blogimg/20210215.jpg
catalog: true
tags:
    - Python Series
---
>æœ¬æ–‡ä¸ºåŸåˆ›æ–‡ç« ï¼Œæœªç»æœ¬äººå…è®¸ï¼Œç¦æ­¢è½¬è½½ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚

# 1.æ•°æ®æ”¶é›†

å‡è®¾æˆ‘ä»¬æƒ³å¯¹æœ€æ–°çš„çƒ­ç‚¹æ–°é—»è¿›è¡Œåˆ†æï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦é¦–å…ˆä»ç½‘ç»œä¸Šçˆ¬å–å½“å‰çš„æœ€æ–°æ–°é—»ï¼Œä»¥[https://news.sina.com.cn/china/](https://news.sina.com.cn/china/)ç½‘ç«™æä¾›çš„æœ€æ–°æ–°é—»ä¸ºä¾‹ï¼š

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson18/18x1.png)

>pythonç½‘ç»œçˆ¬è™«è¯¦ç»†æ•™ç¨‹ï¼š[ã€PythonåŸºç¡€ã€‘ç¬¬å…«è¯¾ï¼šç½‘ç»œçˆ¬è™«](http://shichaoxin.com/2019/11/04/PythonåŸºç¡€-ç¬¬å…«è¯¾-ç½‘ç»œçˆ¬è™«/)ã€‚æœ¬æ–‡ä¸å†è¯¦è¿°è¯¥è¿‡ç¨‹ï¼Œåªåˆ—å‡ºä¸€äº›å…³é”®æ­¥éª¤ã€‚

é¦–å…ˆè·å–é“¾æ¥åœ°å€ï¼Œæ­¥éª¤è§ä¸‹å›¾ï¼š

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson18/18x2.png)

>å¦‚æœç¬¬3æ­¥æ²¡æœ‰ä»»ä½•å†…å®¹ï¼Œåˆ·æ–°ä¸‹ç½‘é¡µå³å¯ã€‚

ç„¶åç‚¹å‡»Responseæ ‡ç­¾ï¼Œç¡®å®šè¯¥é“¾æ¥åŒ…å«æœ‰æœ¬ç½‘é¡µçš„æ–‡å­—å†…å®¹ï¼š

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson18/18x3.png)

å¦‚ä¸Šå›¾çº¢è‰²æ¡†æ ‡ç¤ºçš„éƒ¨åˆ†æ‰€ç¤ºï¼Œè¯´æ˜è¯¥é“¾æ¥åŒ…å«æˆ‘ä»¬æ‰€è¦çš„ç½‘é¡µä¸­çš„æœ€æ–°æ–°é—»çš„å†…å®¹ã€‚

>å¦‚æœè¯¥é“¾æ¥æœªåŒ…å«ç½‘é¡µçš„æ–‡å­—å†…å®¹ï¼Œåˆ™å¯å°è¯•çº¢è‰²åœ†åœˆå†…å‰©ä½™çš„å¦å¤–ä¸‰ä¸ªé“¾æ¥ã€‚

ç¡®å®šå®Œé“¾æ¥ä¹‹åï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ç”¨pythonå¯¹å…¶å†…å®¹è¿›è¡Œçˆ¬å–äº†ã€‚é¦–å…ˆimportä¸€äº›å¿…è¦çš„åº“ï¼š

```python
import requests
from bs4 import BeautifulSoup
import re
```

å¯¹å†…å®¹è¿›è¡Œçˆ¬å–ï¼š

```python
res = requests.get("https://news.sina.com.cn/china/")
print(res.text)
```

å‘ç°å¾—åˆ°çš„æ–‡å­—å†…å®¹éƒ½æ˜¯ä¹±ç ã€‚é€šè¿‡æŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼Œå¾—çŸ¥å…¶ç¼–ç æ–¹å¼ä¸º`utf-8`ï¼š

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson18/18x4.png)

è€Œé»˜è®¤çš„ç¼–ç æ–¹å¼ä¸ºï¼š

```python
print(res.encoding) #è¾“å‡ºä¸ºï¼šISO-8859-1
```

å› æ­¤ä¿®æ”¹å…¶ç¼–ç æ–¹å¼ï¼š

```python
res.encoding = 'utf-8'
print(res.text)
```

ç»“æœè§ä¸‹ï¼ˆéƒ¨åˆ†ï¼‰ï¼š

```html
<a href="https://news.sina.com.cn/c/2021-02-10/doc-ikftpnny6206975.shtml" target="_blank"  title="æ˜¥èŠ‚å‡æœŸæ¥äº† ç‰¢è®°è¿™50æ¡é˜²ç–«è¦ç‚¹">æ˜¥èŠ‚å‡æœŸæ¥äº† ç‰¢è®°è¿™50æ¡é˜²ç–«è¦ç‚¹</a>
            </li>            <li>
<a href="https://news.sina.com.cn/c/2021-02-10/doc-ikftpnny6103607.shtml" target="_blank"  title="ç‰›å¼¹ç´ï¼šé©¬ä¸Šå°±æ˜¯æ˜¥èŠ‚ï¼Œä¸‰ä¸ªå¥½æ¶ˆæ¯å’Œä¸€ä¸ªåæ¶ˆæ¯ï¼">ç‰›å¼¹ç´ï¼šé©¬ä¸Šå°±æ˜¯æ˜¥èŠ‚ï¼Œä¸‰ä¸ªå¥½æ¶ˆæ¯å’Œä¸€ä¸ªåæ¶ˆæ¯ï¼</a>
            </li>            <li>
 <a href="https://news.sina.com.cn/c/xl/2021-02-07/doc-ikftpnny5527323.shtml" target="_blank"  title="æ—¶æ”¿å¾®çºªå½•ä¸¨ç™¾å§“å¿ƒ ä¸­å›½å¹´">æ—¶æ”¿å¾®çºªå½•ä¸¨ç™¾å§“å¿ƒ ä¸­å›½å¹´</a>
            </li>
```

åœ¨ä½¿ç”¨`soup.select`æ—¶ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡`Copy selector`è·å¾—å†…å®¹æ‰€åœ¨è·¯å¾„ï¼š

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson18/18x5.png)

å…¶ä»–æ“ä½œå°±æ²¡æœ‰ç‰¹æ®Šçš„äº†ï¼ŒæŒ‰ç…§ä¹‹å‰åšå®¢[ã€PythonåŸºç¡€ã€‘ç¬¬å…«è¯¾ï¼šç½‘ç»œçˆ¬è™«](http://shichaoxin.com/2019/11/04/PythonåŸºç¡€-ç¬¬å…«è¯¾-ç½‘ç»œçˆ¬è™«/)ä¸­æ‰€ä»‹ç»çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°†çƒ­ç‚¹æ–°é—»çš„æ ‡é¢˜ã€å†…å®¹ã€æ¥æºä»¥åŠå…³é”®è¯éƒ½çˆ¬å–ä¸‹æ¥ï¼Œå¹¶æ”¾åœ¨ä¸€ä¸ªå­—å…¸é‡Œï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨ã€‚

# 2.æ•°æ®å¤„ç†

ä½¿ç”¨pandasçš„DataFrameç›´æ¥è¯»å–å­—å…¸æ ¼å¼çš„æ•°æ®ï¼Œå¾—åˆ°ä»¥ä¸‹DataFrameï¼š

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson18/18x6.png)

ğŸ‘‰æ•´ç†å…³é”®è¯ï¼šå°†æ–‡ç« å…³é”®è¯æ”¾åœ¨ä¸€ä¸ªlisté‡Œï¼š

```python
df["keywords"] = df["keywords"].map(lambda e: e.split(","))
```

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson18/18x7.png)

ğŸ‘‰æ•´ç†æ¥æºï¼šå°†æ¥æºæ‹†åˆ†ä¸ºdatetimeå’Œfromä¸¤ä¸ªæ ä½ï¼š

```python
df[["datetime", "from"]] = df["source"].str.extract('\n+(\d+å¹´\d+æœˆ\d+æ—¥ \d+:\d+)\n+(\w+)', expand=False)
```

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson18/18x8.png)

è½¬æ¢datetimeæ ¼å¼ï¼š

```python
df["datetime"] = pd.to_datetime(df["datetime"], format="%Yå¹´%mæœˆ%dæ—¥ %H:%M")
```

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson18/18x9.png)

å°†æ—¶é—´è½¬æ¢æˆè¿™ä¸ªæ ¼å¼æ›´æ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨ï¼Œä¾‹å¦‚å¦‚æœæˆ‘ä»¬éœ€è¦æå–æ–°é—»å‘è¡¨çš„å¹´ä»½ï¼š

```python
df["datetime"].map(lambda e: e.year)
```

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson18/18x10.png)

ç±»ä¼¼çš„è¿˜æœ‰ï¼š

```python
df["datetime"].map(lambda e: e.month) #æå–æœˆä»½
```

æ ä½sourceç°åœ¨å¯ä»¥è¢«åˆ é™¤äº†ï¼š

```python
del df["source"]
```

ğŸ‘‰è°ƒæ•´æ ä½é¡ºåºï¼š

```python
df = df[["from", "title", "content", "keywords", "datetime"]]
```

![](https://xjeffblogimg.oss-cn-beijing.aliyuncs.com/BLOGIMG/BlogImage/PythonSeries/Lesson18/18x11.png)

ğŸ‘‰å°†æ•´ç†å¥½çš„æ•°æ®å­˜å‚¨è‡³Excelï¼š

```python
df.to_excel("news.xlsx")
```

# 3.ä»£ç åœ°å€

1. [æ—¶äº‹æ–°é—»èµ„æ–™çš„çˆ¬å–å’Œå¤„ç†](https://github.com/x-jeff/Python_Code_Demo/tree/master/Demo18)